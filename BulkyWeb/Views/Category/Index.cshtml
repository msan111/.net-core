@model List<Category>
<div class="container">
    <div class="row pt-4 pb-4">
        <div class="col-6">
            <h2>Categories</h2>

        </div> 
        <div class="col-6 text-end">
            <a asp-controller="Category" asp-action="Create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Create New Category
                
            </a>
        </div>
        
    </div>
</div>
<table class="table">
    <thead class="thead-dark">
    <tr>
        <th scope="col">#</th>
        <th scope="col">Category Name</th>
        <th scope="col">Display Order</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    @{
        var counter = 1;
    }
    @foreach (var obj in Model.OrderBy(u => u.DisplayOrder))
    {
        <tr>
            <th scope="row">@counter</th>
            <td>@obj.Name</td>
            <td>@obj.DisplayOrder</td>
            <td>
                <div class="w-75 btn-group" role="group">
                    <a asp-controller="Category" asp-action="Edit" asp-route-id="@obj.CategoryId" class="btn btn-primary mx-2">
                        <i class="bi bi-pencil-square"></i> Edit
                    </a>
                    <button class="btn btn-danger mx-2" onclick="confirmDelete(@obj.CategoryId)">
                        <i class="bi bi-trash3"></i> Delete
                    </button>
                </div>
            </td>
        </tr>
        counter++;
    }
    </tbody>
</table>
<form id="delete-form" method="post" style="display:none;">
    @Html.AntiForgeryToken()
</form>
<script>
    function confirmDelete(id) {
        if (confirm("Are you sure that you want to delete this Category?")) {
            const form = document.getElementById('delete-form');
            const token = form.querySelector('[name="__RequestVerificationToken"]').value;
            
            fetch(`/Category/DeleteConfirmed/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'RequestVerificationToken': token
                }
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/Category/Index';
                } else {
                    alert('Failed to delete.');
                }
            })
            .catch(error => console.error('Error:', error));
        }
    }

    $(document).ready(function() {
        setTimeout(function() {
            $("#success-alert").fadeOut("slow");
        }, 5000); 
    });
</script>